---
title: GitHub
description: Practical guide to GitHub commands and configuration file examples for deploying applications.
navigation:
  icon: i-mdi:github
seo:
  title: GitHub
  description: Commands, best practices and examples for creating, running and maintaining GitHub repositories and applications.
---

## GHCR

GitHub Container Registry (GHCR) is a container registry service that allows you to store and manage Docker images and OCI (Open Container Initiative) artifacts directly in GitHub. GHCR offers seamless integration with GitHub repositories, making it easier to manage container images for GitHub-hosted projects.

::steps{level="3"}

1.  ### Generate a Personal Access Token (PAT)

    Go to [GitHub](https://github.com/settings/tokens/new) and generate a PAT with `repo` and `packages` permissions.

    Log in to GitHub, go to `Settings` then `Developer settings`. Once in `Developer Settings`, under `Personal access tokens` choose `Tokens (classic)` and generate a new token with the selected permissions (duration and `read:packages` authorization).

2.  ### Log in to GHCR with Docker

    ```shell
    echo "<TOKEN>" | docker login ghcr.io -u <USERNAME> --password-stdin
    ```

3.  ### Pull and run an image

    ```shell
    docker pull ghcr.io/<USERNAME>/<IMAGE_NAME>
    docker run -d -p <HOST_PORT>:<CONTAINER_PORT> ghcr.io/<USERNAME>/<IMAGE_NAME>
    ```

4.  ### Log out of GHCR

        ```shell
        docker logout ghcr.io
        ```

    ::

## GitHub Actions

We will use GitHub Actions with GHCR to build and push our images.

Create the `.github/workflows/` folders at the root of the project.

## Workflows

To build and push our Docker images we will use GHCR. In the `ghcr.yaml` file, add the following commands.

For SSH deployment, we will use the GitHub Actions utility [appleboy](https://github.com/appleboy/ssh-action).

:::code-group

```yaml [ghcr.yaml]
name: GitHub Container Registry

on:
  push:
    branches:
      - main

jobs:
  ghcr:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      packages: write
      attestations: write
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Log in to GitHub Container Registry
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: Set lowercase repository owner
        run: echo "REPO_OWNER=$(echo ${{ github.repository_owner }} | tr '[:upper:]' '[:lower:]')" >> $GITHUB_ENV

      - name: Build and push Api Docker image
        run: |
          docker build -t ghcr.io/${{ env.REPO_OWNER }}/<TAG_NAME>:latest ./<APP_CODE>
          docker push ghcr.io/${{ env.REPO_OWNER }}/<TAG_NAME>:latest

      - name: Logout from GHCR
        run: docker logout ghcr.io
```

```yaml [deploy.yaml]

...
deploy:
  needs: [ghcr]
  runs-on: ubuntu-latest
  steps:
    - name: Deploy using ssh
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.SSH_HOST }}
        username: ${{ secrets.SSH_USERNAME }}
        key: ${{ secrets.SSH_KEY }}
        port: ${{ secrets.SSH_PORT }}
        script: |
          echo ${{ secrets.GHCR_PAT }} | docker login ghcr.io -u ${{ github.REPOSITORY_OWNER }} --password-stdin
          docker pull ghcr.io/${{ env.REPO_OWNER }}/<TAG_NAME>:latest
          docker compose compose.prod.yaml
          docker logout ghcr.io
```

:::

#### Connection with username and private SSH key

First, configure the keys on the VPS. You can create keys on your Ubuntu VPS using the documentation in the `Keys` section, then add the `SSH_KEY` secret to the GitHub repository (private key).

Configure SSH keys for GitHub [documentation](https://docs.github.com/en/authentication/connecting-to-github-with-ssh/about-ssh).

### Configure on the VPS

#### Create a `compose.prod.yaml` file

```yaml [compose.prod.yaml]
services:
  app:
    image: ghcr.io/${{ env.REPO_OWNER }}/<TAG_NAME>:latest
    ports:
      - "XXXX:XXXX"
```

::tip
[Resources]

- [GitHub Docs](https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry)
- [Medium](https://medium.com/@ajay-er/automate-docker-image-deployment-to-ghcr-with-github-actions-97bb9a318d7c)
- [Programonaut](https://www.programonaut.com/how-to-deploy-a-docker-image-to-a-server-using-github-actions/)
  ::
